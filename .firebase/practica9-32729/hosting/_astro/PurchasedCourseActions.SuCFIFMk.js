import{j as e}from"./jsx-runtime.CLpGMVip.js";import{r as c}from"./index.BL7xzsR_.js";import{a as d,B as u}from"./button.NJqs0wxn.js";const m=s=>{const[r,t]=c.useState([]);return c.useEffect(()=>{(async()=>{if(s)try{const a=await(await fetch(`https://firestore.googleapis.com/v1/projects/practica9-32729/databases/(default)/documents/purchases/${s}`)).json();console.log("Datos de purchases obtenidos:",a);const i=a?.fields?.courses?.arrayValue?.values?.map(n=>n.stringValue)||[];t(i)}catch(o){console.error("Error obteniendo compras:",o)}})()},[s]),r},f=({course:s})=>{const r=async()=>{const t=localStorage.getItem("userId");if(!t){alert("Debes iniciar sesión para añadir cursos al carrito.");return}await d(t,s)&&alert("Curso añadido al carrito!")};return e.jsx("button",{onClick:r,className:"p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600",children:e.jsx("img",{src:"../anadir-a-la-cesta.png",alt:"Añadir",className:"w-5 h-5"})})},h=({isOpen:s,onClose:r,videoUrl:t,temario:l})=>{const o=c.useRef(null);return c.useEffect(()=>{s?o.current?.showModal():o.current?.close()},[s]),e.jsxs("dialog",{ref:o,className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-2xl",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Contenido del Curso"}),e.jsx("div",{className:"mb-4",children:e.jsx("iframe",{src:t,title:"Video del Curso",className:"w-full h-64 rounded-lg",allow:"autoplay; encrypted-media"})}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Temario:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:l.map((a,i)=>e.jsx("li",{children:a},i))})]}),e.jsx("div",{className:"flex justify-end space-x-2 mt-4",children:e.jsx(u,{variant:"secondary",onClick:r,children:"Cerrar"})})]})},p=({courseId:s})=>{const[r,t]=c.useState(!1),[l,o]=c.useState(null);return c.useEffect(()=>{fetch(`https://firestore.googleapis.com/v1/projects/practica9-32729/databases/(default)/documents/courses/${s}`).then(a=>a.json()).then(a=>{a?.fields&&o({video:a.fields.video?.stringValue||"",temario:a.fields.temario?.arrayValue?.values?.map(i=>i.stringValue)||[]})}).catch(a=>console.error("Error obteniendo curso:",a))},[s]),e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>t(!0),className:"bg-blue-600 text-white px-3 py-1 rounded-md",children:"Ver Contenido"}),r&&l&&e.jsx(h,{isOpen:r,onClose:()=>t(!1),videoUrl:l.video,temario:l.temario})]})},b=({course:s,userId:r})=>{const t=m(r),[l,o]=c.useState(!1);return c.useEffect(()=>{t.length!==0&&(console.log("Cursos comprados:",t),console.log(`Verificando si ${s.id} está comprado...`),o(t.includes(s.id)),console.log(`Resultado para ${s.id}:`,t.includes(s.id)))},[t,s.id]),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("p",{className:"text-lg font-semibold text-gray-800",children:["$",s.precio]}),l?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-green-600 font-bold",children:"¡Curso comprado!"}),e.jsx(p,{courseId:s.id})]}):e.jsx(f,{course:s})]})};export{b as default};
